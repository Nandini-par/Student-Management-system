{% extends 'students/base.html' %}
{% block content %}

<h1>Student List</h1>

<form method="get" class="search-form">
    <input
        type="search"
        name="q"
        placeholder="Search student..."
        value="{{ request.GET.q|default:'' }}"
    >
    <button type="submit">Search</button>

    {% if user.is_staff %}
        <a href="{% url 'student_add' %}" class="add-btn">Add Student</a>
    {% endif %}
</form>

<div class="table-responsive">
<table class="student-table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Age</th>
            <th>Phone</th>
            <th>Course</th>
            <th>Duration</th>
            <th>Fee</th>
            <th>Teachers</th>
            {% if user.is_staff %}
                <th>Actions</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
    {% for student in students %}
        <tr>
            <td>{{ student.name }}</td>
            <td>{{ student.email }}</td>
            <td>{{ student.age }}</td>
            <td>{{ student.phone_number|default:"—" }}</td>

            
            <td>
                {% if student.course %}
                    {{ student.course.name }}
                {% else %}
                    —
                {% endif %}
            </td>
            <td>
                {% if student.course %}
                    {{ student.course.duration }}
                {% else %}
                    —
                {% endif %}
            </td>
            <td>
                {% if student.course %}
                    {{ student.course.fee }}
                {% else %}
                    —
                {% endif %}
            </td>

            <td>
                {% if student.teachers.all %}
                    {% for teacher in student.teachers.all %}
                        {{ teacher.name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                {% else %}
                    —
                {% endif %}
            </td>

            {% if user.is_staff %}
            <td class="actions">
                <a href="{% url 'student_update' student.id %}">Edit</a>
                <a href="{% url 'student_delete' student.id %}">Delete</a>
            </td>
            {% endif %}
        </tr>
    {% empty %}
        <tr>
            <td colspan="{% if user.is_staff %}9{% else %}8{% endif %}" class="no-data">
                No students found
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>
</div>

{% endblock %}
